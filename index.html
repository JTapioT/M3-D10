<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
      integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./styles.css" />
    <title>M2-D5</title>
  </head>
  <body>

    <!-- NAVIGATION AREA -->

    <nav class="navbar navbar-expand-md justify-content-start sticky-top">
      <img src="./assets/netflix_logo.png" width="90" height style="object-fit: cover;" alt="Netflix logo" />
      <ul class="nav ml-3" id="navbarToggleHeader">
        <li class="nav-item mb-0 mr-3 h6 text-white-50">
          <a class="nav-link p-0">Home</a>
        </li>
        <li class="nav-item mb-0 mr-3 h6 text-white-50">
          <a class="nav-link p-0">TV Shows</a>
        </li>
        <li class="nav-item mb-0 mr-3 h6 text-white-50">
          <a class="nav-link active p-0">Movies</a>
        </li>
        <li class="nav-item mb-0 mr-3 h6 text-white-50">
          <a class="nav-link p-0">Recently Added</a>
        </li>
        <li class="nav-item mb-0 mr-3 h6 text-white-50">
          <a class="nav-link p-0">My List</a>
        </li>
      </ul>
      <!-- <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggleHeader" aria-controls="navbarToggleHeader" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button> -->

      <div class="d-flex nav-tools">
        <img
          src="./assets/search-solid.svg"
          class="search-icon mr-3 nav-tools-img"
          alt="Search icon"
          width="18"
          height="18"
          role="img"
        />

        <p class="mb-0 mr-3 align-self-center text-uppercase nav-tools-kids">
          kids
        </p>

        <img
          src="./assets/bell-fill.svg"
          class="search-icon mr-3 nav-tools-img"
          alt="Search icon"
          width="18"
          height="18"
          role="img"
        />

        <div class="dropdown">
          <a
            class="btn dropdown-toggle p-0"
            href="#"
            role="button"
            id="dropdownMenuLink"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
          >
            <img
              src="./assets/avatar.png"
              alt="avatar image"
              width="30"
              height="30"
            />
          </a>

          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuLink">
            <a class="dropdown-item" href="#">Action</a>
            <a class="dropdown-item" href="./backoffice.html">BackOffice</a>
            <a class="dropdown-item" href="#">Something else here</a>
          </div>
        </div>
      </div>
    </nav>


      <!-- MAIN AREA -->
      <div id="headerArea" class="container-fluid pl-4 pr-4 mt-3">

      <!--TV SHOWS - DROP DOWN - MENU TOOLS -->
        <div class="row">
          <div class="col-6">
            <h1 class="d-inline-block mr-3 section-title mb-0">Movies</h1>
            <div class="dropdown d-inline-block ml-4">
              <a
                class="dropdown-toggle genre-btn"
                type="button"
                id="dropdownMenuButton"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                Genres
            </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" href="#">Action</a>
                <a class="dropdown-item" href="#">Another action</a>
                <a class="dropdown-item" href="#">Something else here</a>
              </div>
            </div>
          </div>


          <div class="col-6">
            <div class="d-flex justify-content-end">
              <a href="" class="menu-tool-icon-group">
                <img src="./assets/bars-solid.svg" class="menu-tool-icon1" alt="tool-bar" width="20" height="20">
              </a>
              <a href="" class="menu-tool-icon-group">
                <img src="./assets/th-large-solid.svg" class="menu-tool-icon2" alt="" width="20" height="20">
              </a>
            </div>
          </div>

        </div>
      </div>

    <!-- FOOTER AREA -->

    <footer>
    <div class="container">
      <div class="row">
        <div class="col-8 col-8 offset-2">
          <!-- Insert logos to this flex-container -->
          <a><img src="./assets/facebook-square-brands.svg" class="footer-icon" alt="footer-link-icon" width="25" height="25"></a>
          <a><img src="./assets/instagram-square-brands.svg" class="footer-icon" alt="footer-link-icon" width="25" height="25"></a>
          <a> <img src="./assets/twitter-brands.svg" class="footer-icon"   alt="footer-link-icon" width="25" height="25"></a>
          <a> <img src="./assets/youtube-brands.svg" class="footer-icon"   alt="footer-link-icon" width="25" height="25"></a>
        </div>
        <div class="col-8 col-8 offset-2 mt-3">
          <!-- I think it is great idea to try row here for four tet links-->
          <div class="row">
            <p class="col-6 col-lg-4">Audio and Subtitles</p>
            <p class="col-6 col-lg-4">Audio Description</p>
            <p class="col-6 col-lg-4">Help Center</p>
            <p class="col-6 col-lg-4">Gift Cards</p>
            <p class="col-6 col-lg-4">Media Center</p>
            <p class="col-6 col-lg-4">Investor Relations</p>
            <p class="col-6 col-lg-4">Jobs</p>
            <p class="col-6 col-lg-4">Terms of Use</p>
            <p class="col-6 col-lg-4">Privacy</p>
            <p class="col-6 col-lg-4">Legal Notices</p>
            <p class="col-6 col-lg-4">Cookie Preferences</p>
            <p class="col-6 col-lg-4">Corporate Information</p>
            <p class="col-6 col-lg-4">Contact Us</p>
          </div>
        </div>
      </div>
      <a href="#"class="col-8 offset-2 footer-btn">Service Code</a>
      <p class="col-8 offset-2 mt-4 footer-copyright">1997-2021 Neflix, Inc. {i-0d00fcda2fdf9c0de}</p>
    </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>

    <script>
      const token = "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTRiMWJlNjRiYjUzZDAwMTViMTllY2IiLCJpYXQiOjE2MzIzMTIyOTQsImV4cCI6MTYzMzUyMTg5NH0.3CzDPp4QqBgiD6bLQdmJvbu5eazZmxZjDOXlu7ADoEA";

      const url = "https://striveschool-api.herokuapp.com/api/movies";

      function populateByCategories(category, categoryMovies) {
        // Category & categoryMovies as array[{},{}..]
        let headerArea = document.querySelector("#headerArea");

        let sectionContainer = document.createElement("div");
        sectionContainer.className = "container-fluid pl-4 mr-0 pr-0";
        let sectionTitle = document.createElement("h4");
        //sectionTitle.id = "trendingNow";
        sectionTitle.className ="mt-3 mb-3 section-title";
        sectionTitle.innerText = category;
        sectionContainer.appendChild(sectionTitle);

        let imageContainer = document.createElement("div");
        imageContainer.className = "row pl-3 flex-md-nowrap";

        categoryMovies.forEach((movie) => {
          imageContainer.innerHTML += `
          <div class="col-md-4 col-lg-3 col-xl-2 pr-1 pl-0">
            <a href=./details.html?id=${movie._id}&category=${movie.category}>
              <img src=${movie.imageUrl} alt="" class="section-img">
            </a>
          </div>`;
          sectionContainer.appendChild(imageContainer);
        })


        /* 
        <div class="container-fluid pl-4 mr-0 pr-0">
        <!-- Trending Now Section -->
        <h4 class="mt-3 mb-3 section-title">Trending Now</h4>

        <div id="trendingNow" class="row pl-3 flex-md-nowrap" style="overflow-y:scroll;">

          <div class="col-4 col-md-4 col-lg-3 col-xl-2 pr-1 pl-0">
          <a href="">
            <img src="./assets/media/media1.jpg" alt="" class="section-img">
          </a>
          </div>

        </div>
      </div>
        */

        headerArea.after(sectionContainer);
      }

        async function fetchMovies(category) {
          try {
            let response = await fetch(url + "/" + category, {
              headers: {
                "Authorization": token
              }
            })

            if(response.ok) {
              let movieData = await response.json();
              return movieData;
              //console.log(movieData);
              //console.log(`Movies from category: ${category}: ${movieData}`);
            }
          } catch (error) {
            console.log(error);
          }
        }

        async function fetchFromAllCategories(categoryList) {
          categoryList.forEach(async (category) => {
            let categoryMovies = await fetchMovies(category);
            if(categoryMovies.length > 1) {
              populateByCategories(category, categoryMovies);
            }
          })
        }
      
        async function fetchCategories(url) {
          try {
            let response = await fetch(url, {
              headers: {
                "Authorization": token
              }
            });
            if(response.ok) {
              let movieCategories = await response.json();
              console.log(movieCategories);
              fetchFromAllCategories(movieCategories);
              //return data;
            } else {
              // Can I actually just throw response??
              throw response;
            }
          } catch (error) {
            console.log(error);
          }
        }

      window.onload = () => {
        fetchCategories(url);
      }
    </script>


  </body>
</html>
